<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CineXpress - Movie Details</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar">
  <div class="logo">CineXpress</div>
  
  <!-- Menu Toggle -->
  <button class="menu-toggle" aria-label="Menu">
    <span class="hamburger"></span>
  </button>
  
  <!-- Main Navigation -->
  <nav class="nav-links">
    <ul>
      <li><a href="#" class="active">Home</a></li>
      <li><a href="#">Movies</a></li>
      <li><a href="#">TV Shows</a></li>
      <li><a href="#">Genres <i class="fas fa-chevron-down"></i></a></li>
      <li><a href="#">Upcoming</a></li>
      <li><a href="#">My Watchlist</a></li>
      
    </ul>
  </nav>
  
  <!-- Search & User Section -->
    <div class="navigation">
      <a href="index.html"><img class="backbtn" src="images/back.png" alt=""></a>
  </div>
</header>

  <main class="movie-details-container" id="movieDetails">
    <!-- Content will be dynamically inserted here -->
  </main>

  <script>
      const API_KEY = '38d01855c73113431d5d64e22d399ac4'; // Replace with your key
const BASE_URL = 'https://api.themoviedb.org/3';


document.querySelectorAll('.movie-card').forEach(card => {
  card.addEventListener('mouseenter', () => {
  });
});


const menuToggle = document.querySelector('.menu-toggle');
const navLinks = document.querySelector('.nav-links');

menuToggle.addEventListener('click', () => {
  navLinks.classList.toggle('active');
  menuToggle.classList.toggle('active');
  

  document.body.classList.toggle('no-scroll');
});


document.querySelectorAll('.nav-links a').forEach(link => {
  link.addEventListener('click', () => {
    navLinks.classList.remove('active');
    menuToggle.classList.remove('active');
    document.body.classList.remove('no-scroll');
  });
});


document.addEventListener('click', (e) => {
  if (!navLinks.contains(e.target) && !menuToggle.contains(e.target)) {
    navLinks.classList.remove('active');
    menuToggle.classList.remove('active');
    document.body.classList.remove('no-scroll');
  }
});


      // Function to show movie details
async function showMovieDetails(movieId) {
  // Fetch movie details
  const movie = await fetch(`${BASE_URL}/movie/${movieId}?api_key=${API_KEY}&append_to_response=videos,credits`)
    .then(res => res.json());

  // Fetch similar movies
  const similar = await fetch(`${BASE_URL}/movie/${movieId}/similar?api_key=${API_KEY}`)
    .then(res => res.json());

  // Update URL (for sharing)
  window.history.pushState({}, '', `movie.html?id=${movieId}`);

  // Render details
  document.getElementById('movieDetails').innerHTML = `
    <section class="movie-hero" style="background-image: url('https://image.tmdb.org/t/p/original${movie.backdrop_path}')">
      <div class="hero-overlay"></div>
      <div class="movie-poster">
        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
      </div>
      <div class="movie-info">
        <h1>${movie.title} <span>(${new Date(movie.release_date).getFullYear()})</span></h1>
        
        <div class="meta">
          <span class="rating">⭐ ${movie.vote_average.toFixed(1)}</span>
          <span>${movie.runtime} min</span>
          <span>${movie.genres.map(g => g.name).join(', ')}</span>
        </div>

        <h3>Overview</h3>
        <p>${movie.overview}</p>

        <div class="cta-buttons">
          <button class="watch-trailer" data-youtube-id="${movie.videos?.results[0]?.key}">
            ▶ Play Trailer
          </button>
          <button class="add-favorites" data-movie-id="${movie.id}">
  + My List
</button>
        </div>
      </div>
    </section>

    <section class="cast-section">
      <h2>Cast</h2>
      <div class="cast-grid">
        ${movie.credits.cast.slice(0, 10).map(actor => `
          <div class="actor-card">
            <img src="${actor.profile_path ? `https://image.tmdb.org/t/p/w200${actor.profile_path}` : 'placeholder-actor.jpg'}" alt="${actor.name}">
            <h4>${actor.name}</h4>
            <p>${actor.character}</p>
          </div>
        `).join('')}
      </div>
    </section>

    <section class="similar-movies">
      <h2>You May Also Like</h2>
      <div class="movie-grid">
        ${similar.results.slice(0, 5).map(movie => `
          <div class="movie-card" onclick="showMovieDetails(${movie.id})">
            <img src="https://image.tmdb.org/t/p/w300${movie.poster_path}" alt="${movie.title}">
          </div>
        `).join('')}
      </div>
    </section>
  `;

  // Add trailer modal functionality
  document.querySelector('.watch-trailer')?.addEventListener('click', (e) => {
    const youtubeId = e.target.dataset.youtubeId;
    if (youtubeId) {
      document.body.insertAdjacentHTML('beforeend', `
        <div class="trailer-modal">
          <div class="modal-content">
            <iframe src="https://www.youtube.com/embed/${youtubeId}?autoplay=1" frameborder="0" allowfullscreen></iframe>
            <button class="close-modal">×</button>
          </div>
        </div>
      `);
      
      document.querySelector('.close-modal').addEventListener('click', () => {
        document.querySelector('.trailer-modal').remove();
      });
    }
  });
}

// On page load (for details page)
if (window.location.pathname.includes('movie.html')) {
  const urlParams = new URLSearchParams(window.location.search);
  const movieId = urlParams.get('id');
  if (movieId) showMovieDetails(movieId);
}

// Add to script.js
document.addEventListener('click', async (e) => {
  if (e.target.classList.contains('add-favorites')) {
    const movieId = e.target.dataset.movieId;
    await addToWatchlist(movieId);
    e.target.textContent = '✓ Added';
    e.target.style.backgroundColor = '#4CAF50'; // Green confirmation
  }
});

// Using localStorage for watchlist (alternative: Firebase/backend)
async function addToWatchlist(movieId) {
  try {
    // 1. Fetch movie details with error handling
    const response = await fetch(`${BASE_URL}/movie/${movieId}?api_key=${API_KEY}`);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const movie = await response.json();
    
    // 2. Initialize or get existing watchlist
    let watchlist = JSON.parse(localStorage.getItem('watchlist') || "[]");
    
    // Fix: Ensure watchlist is always an array
    if (!Array.isArray(watchlist)) {
      console.warn("Watchlist was corrupted - resetting");
      watchlist = [];
    }
    
    // 3. Check for duplicates
    if (!watchlist.some(m => m.id === movie.id)) {
      watchlist.push({
        id: movie.id,
        title: movie.title,
        poster_path: movie.poster_path,
        addedAt: new Date().toISOString()
      });
      
      // 4. Save back to localStorage
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
      console.log("Added to watchlist:", movie.title);
      return true;
    }
    return false;
    
  } catch (error) {
    console.error("Watchlist error:", error);
    return false;
  }
}
// In script.js
function displayWatchlist() {
  const watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
  const container = document.getElementById('watchlistContainer');
  
  if (watchlist.length === 0) {
    container.innerHTML = `<p class="empty">Your watchlist is empty</p>`;
    return;
  }

  container.innerHTML = watchlist.map(movie => `
    <div class="watchlist-item" onclick="showMovieDetails(${movie.id})">
      <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="${movie.title}">
      <div>
        <h3>${movie.title}</h3>
        <small>Added: ${new Date(movie.addedAt).toLocaleDateString()}</small>
        <button class="remove-btn" data-movie-id="${movie.id}">× Remove</button>
      </div>
    </div>
  `).join('');
}

// Call this on watchlist.html load
if (window.location.pathname.includes('watchlist.html')) {
  displayWatchlist();
}

// Add to your movie details page
async function addLegalStreamingLinks(movieId) {
  const response = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/watch/providers?api_key=${API_KEY}`);
  const data = await response.json();
  
  if (data.results?.US?.flatrate) {
    const providers = data.results.US.flatrate;
    let html = '<div class="streaming-options"><h4>Available on:</h4>';
    
    providers.forEach(provider => {
      html += `
        <a href="https://www.themoviedb.org/movie/${movieId}/watch" 
           target="_blank"
           class="provider-link">
          <img src="https://image.tmdb.org/t/p/w45${provider.logo_path}" 
               alt="${provider.provider_name}">
        </a>
      `;
    });
    
    document.querySelector('.movie-info').innerHTML += html;
  }
}

// In your movie details function
async function addLegalDownloadLink(movieId) {
  const officialSources = {
    123: "https://archive.org/details/legal-movie", // Example public domain
    456: "https://studio.com/free-download" // Example official source
  };

  if (officialSources[movieId]) {
    document.querySelector('.cta-buttons').innerHTML += `
      <a href="${officialSources[movieId]}" 
         class="download-btn"
         target="_blank"
         rel="noopener noreferrer">
        <i class="fas fa-download"></i> Download
      </a>
    `;
  }
}

// Using JustWatch API or TMDB watch providers
async function getOfficialLinks(movieId) {
  const res = await fetch(`https://apis.justwatch.com/content/titles/movie/${movieId}/locale/en_US`);
  // Parse response for purchase/rental links
}

// Alternative placement - before similar movies section
document.querySelector('.similar-movies')?.insertAdjacentHTML('beforebegin', `
  <div class="download-section">
    <h3>Download</h3>
    ${downloadHTML}
    <p class="disclaimer">This film is in the public domain</p>
  </div>
`);
  </script>
</body>
</html>
